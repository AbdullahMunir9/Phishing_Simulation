<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Security Awareness Training</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: #f0f2f5;
      line-height: 1.6;
    }
    
    .top-bar {
      background: white;
      border-bottom: 1px solid #e4e6eb;
      padding: 16px 0;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 2px 4px rgba(0,0,0,0.08);
    }
    
    .top-bar-content {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .top-bar h1 {
      font-size: 24px;
      font-weight: 600;
      color: #1c1e21;
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 0;
    }
    
    .user-info {
      font-size: 14px;
      color: #65676b;
      margin-top: 4px;
    }
    
    .btn-back {
      background: #e4e6eb;
      color: #1c1e21;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      font-weight: 500;
      text-decoration: none;
      transition: background 0.2s;
      font-size: 15px;
    }
    
    .btn-back:hover {
      background: #d8dadf;
      color: #1c1e21;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 30px 20px;
    }
    
    .progress-bar-wrapper {
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 1px 2px rgba(0,0,0,0.1);
    }
    
    .progress-label {
      font-size: 14px;
      font-weight: 500;
      color: #65676b;
      margin-bottom: 8px;
    }
    
    .progress {
      height: 8px;
      border-radius: 4px;
      background: #e4e6eb;
    }
    
    .progress-bar {
      background: linear-gradient(90deg, #4CAF50, #45a049);
      border-radius: 4px;
    }
    
    .content-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }
    
    .card {
      background: white;
      border-radius: 8px;
      box-shadow: 0 1px 2px rgba(0,0,0,0.1);
      padding: 0;
      overflow: hidden;
    }
    
    .card-header {
      padding: 16px 20px;
      border-bottom: 1px solid #e4e6eb;
      font-weight: 600;
      font-size: 17px;
      color: #1c1e21;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .card-body {
      padding: 20px;
    }
    
    .video-container {
      margin-bottom: 16px;
    }
    
    .video-wrapper {
      position: relative;
      padding-bottom: 56.25%;
      height: 0;
      overflow: hidden;
      border-radius: 8px;
      background: #000;
    }
    
    .video-wrapper iframe {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border: none;
    }
    
    .video-title {
      font-size: 14px;
      font-weight: 500;
      color: #1c1e21;
      margin-top: 8px;
      margin-bottom: 4px;
    }
    
    .video-duration {
      font-size: 13px;
      color: #65676b;
    }
    
    .doc-section {
      margin-bottom: 20px;
    }
    
    .doc-section h3 {
      font-size: 16px;
      font-weight: 600;
      color: #1c1e21;
      margin-bottom: 12px;
    }
    
    .doc-list {
      list-style: none;
      padding: 0;
    }
    
    .doc-list li {
      padding: 12px;
      background: #f7f8fa;
      border-radius: 6px;
      margin-bottom: 8px;
      font-size: 14px;
      color: #1c1e21;
      line-height: 1.5;
    }
    
    .doc-list strong {
      color: #4CAF50;
      font-weight: 600;
    }
    
    .tip-box {
      background: #e7f3ff;
      border-left: 4px solid #1877f2;
      padding: 12px 16px;
      border-radius: 6px;
      margin-bottom: 12px;
      font-size: 14px;
      color: #1c1e21;
    }
    
    .warning-box {
      background: #fff3cd;
      border-left: 4px solid #ff9800;
      padding: 12px 16px;
      border-radius: 6px;
      margin-bottom: 12px;
      font-size: 14px;
      color: #1c1e21;
    }
    
    .danger-box {
      background: #ffe8e8;
      border-left: 4px solid #f44336;
      padding: 12px 16px;
      border-radius: 6px;
      margin-bottom: 12px;
      font-size: 14px;
      color: #1c1e21;
    }
    
    .quiz-section {
      background: white;
      border-radius: 8px;
      box-shadow: 0 1px 2px rgba(0,0,0,0.1);
      padding: 0;
      overflow: hidden;
      margin-bottom: 20px;
    }
    
    .quiz-question {
      padding: 20px;
      border-bottom: 1px solid #e4e6eb;
    }
    
    .quiz-question h3 {
      font-size: 16px;
      font-weight: 600;
      color: #1c1e21;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .quiz-question p {
      font-size: 15px;
      color: #1c1e21;
      margin-bottom: 16px;
    }
    
    .form-check {
      padding: 12px;
      border-radius: 6px;
      margin-bottom: 8px;
      transition: background 0.2s;
      display: flex;
      align-items: flex-start;
    }
    
    .form-check:hover {
      background: #f7f8fa;
    }
    
    .form-check-input {
      width: 18px;
      height: 18px;
      margin-top: 2px;
      cursor: pointer;
      flex-shrink: 0;
    }
    
    .form-check-input:checked {
      background-color: #4CAF50;
      border-color: #4CAF50;
    }
    
    .form-check-label {
      margin-left: 10px;
      cursor: pointer;
      color: #1c1e21;
      font-size: 15px;
      flex: 1;
    }
    
    .key-points {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 16px;
      margin-bottom: 20px;
    }
    
    .key-point {
      background: white;
      padding: 16px;
      border-radius: 8px;
      box-shadow: 0 1px 2px rgba(0,0,0,0.1);
      border-left: 4px solid #4CAF50;
    }
    
    .key-point-icon {
      font-size: 24px;
      margin-bottom: 8px;
    }
    
    .key-point-title {
      font-size: 15px;
      font-weight: 600;
      color: #1c1e21;
      margin-bottom: 4px;
    }
    
    .key-point-text {
      font-size: 14px;
      color: #65676b;
    }
    
    .complete-section {
      background: white;
      border-radius: 8px;
      box-shadow: 0 1px 2px rgba(0,0,0,0.1);
      padding: 24px;
      text-align: center;
    }
    
    .complete-section h3 {
      font-size: 18px;
      font-weight: 600;
      color: #1c1e21;
      margin-bottom: 12px;
    }
    
    .complete-section p {
      font-size: 14px;
      color: #65676b;
      margin-bottom: 20px;
    }
    
    .btn-complete {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 12px 32px;
      border-radius: 6px;
      font-weight: 600;
      font-size: 15px;
      cursor: pointer;
      transition: background 0.2s;
      width: 100%;
      max-width: 400px;
    }
    
    .btn-complete:hover:not(:disabled) {
      background: #45a049;
    }
    
    .btn-complete:disabled {
      background: #c8c8c8;
      cursor: not-allowed;
    }
    
    #statusMessage {
      margin-top: 16px;
      font-size: 14px;
      font-weight: 500;
      padding: 12px;
      border-radius: 6px;
    }
    
    .text-success {
      color: #4CAF50;
      background: #e8f5e9;
    }
    
    .text-danger {
      color: #f44336;
      background: #ffebee;
    }
    
    .example-phishing {
      background: #f7f8fa;
      padding: 16px;
      border-radius: 8px;
      border: 1px solid #e4e6eb;
      margin-bottom: 16px;
    }
    
    .example-header {
      font-size: 13px;
      color: #65676b;
      margin-bottom: 8px;
      font-weight: 500;
    }
    
    .example-content {
      font-size: 14px;
      color: #1c1e21;
      font-family: 'Courier New', monospace;
      background: white;
      padding: 12px;
      border-radius: 4px;
      border: 1px solid #e4e6eb;
      margin-bottom: 8px;
    }
    
    .red-flag {
      color: #f44336;
      font-weight: 600;
    }
    
    @media (max-width: 968px) {
      .content-grid {
        grid-template-columns: 1fr;
      }
      
      .key-points {
        grid-template-columns: 1fr;
      }
      
      .top-bar-content {
        flex-direction: column;
        align-items: flex-start;
        gap: 12px;
      }
    }
  </style>
</head>

<body>
  <div class="top-bar">
    <div class="top-bar-content">
      <div>
        <h1>üõ°Ô∏è Security Awareness Training</h1>
        <div class="user-info">Enrolled: {{ email }}</div>
      </div>
      <a href="{{ url_for('frontpage') }}" class="btn-back">‚Üê Dashboard</a>
    </div>
  </div>

  <div class="container">
    

    <div class="key-points">
      <div class="key-point">
        <div class="key-point-icon">üéØ</div>
        <div class="key-point-title">Learn to Identify</div>
        <div class="key-point-text">Recognize phishing attempts before they cause harm</div>
      </div>
      <div class="key-point">
        <div class="key-point-icon">üîí</div>
        <div class="key-point-title">Protect Data</div>
        <div class="key-point-text">Keep sensitive information secure from attackers</div>
      </div>
      <div class="key-point">
        <div class="key-point-icon">‚ö°</div>
        <div class="key-point-title">Quick Response</div>
        <div class="key-point-text">Know exactly what to do when suspicious</div>
      </div>
      <div class="key-point">
        <div class="key-point-icon">üë•</div>
        <div class="key-point-title">Team Security</div>
        <div class="key-point-text">Everyone plays a role in organizational safety</div>
      </div>
    </div>

    <div class="content-grid">
      <div>
        <div class="card">
          <div class="card-header">üé• Training Videos</div>
          <div class="card-body">
            <div class="video-container">
              <div class="video-wrapper">
                <iframe src="https://www.youtube.com/embed/3GBmpqhQI8s" allowfullscreen></iframe>
              </div>
              <div class="video-title">What is Phishing?</div>
            </div>

            <div class="video-container">
              <div class="video-wrapper">
                <iframe src="https://www.youtube.com/embed/ytJjyswLRTc" allowfullscreen></iframe>
              </div>
              <div class="video-title">Real-World Phishing Examples</div>
            </div>

            <div class="video-container">
              <div class="video-wrapper">
                <iframe src="https://www.youtube.com/embed/vqiRHdTx0pY" allowfullscreen></iframe>
              </div>
              <div class="video-title">Understanding Phishing Attacks</div>
            </div>
          </div>
        </div>
      </div>

      <div>
        <div class="card">
          <div class="card-header">üìö Essential Knowledge</div>
          <div class="card-body">
            <div class="doc-section">
              <h3>Red Flags in Emails</h3>
              <ul class="doc-list">
                <li><strong>Sender Address:</strong> Look for misspellings like "paypa1.com" instead of "paypal.com"</li>
                <li><strong>Generic Greetings:</strong> "Dear Customer" instead of your actual name</li>
                <li><strong>Urgency/Threats:</strong> "Act now or your account will be closed!"</li>
                <li><strong>Suspicious Links:</strong> Hover to see the real destination URL</li>
                <li><strong>Unexpected Attachments:</strong> Files you didn't request, especially .exe or .zip</li>
              </ul>
            </div>

            <div class="tip-box">
              <strong>üí° Pro Tip:</strong> Legitimate companies never ask for passwords, credit card numbers, or Social Security numbers via email.
            </div>

            <div class="warning-box">
              <strong>‚ö†Ô∏è Warning:</strong> Attackers often impersonate IT support, HR departments, or executives to gain trust.
            </div>

            <div class="danger-box">
              <strong>üö® Never Click:</strong> If something feels off, don't click any links. Contact the sender through official channels instead.
            </div>
          </div>
        </div>

        <div class="card" style="margin-top: 20px;">
          <div class="card-header">üîç Example Analysis</div>
          <div class="card-body">
            <div class="example-phishing">
              <div class="example-header">Suspicious Email Example:</div>
              <div class="example-content">
                From: <span class="red-flag">security@paypa1-verify.com</span><br>
                Subject: <span class="red-flag">URGENT: Verify Account Now!</span><br><br>
                Dear <span class="red-flag">Valued Customer</span>,<br><br>
                Your account has been <span class="red-flag">suspended due to unusual activity</span>. Click here immediately to verify your identity or <span class="red-flag">your account will be permanently deleted</span> within 24 hours.<br><br>
                <span class="red-flag">[Verify Now]</span>
              </div>
              <strong style="font-size: 14px; color: #f44336;">‚ùå This email has 5+ red flags! Can you spot them?</strong>
            </div>
          </div>
        </div>
      </div>
    </div>

  <div class="quiz-section">
    <div class="quiz-question">
      <h3>üß† Knowledge Check</h3>
      <p><strong>Answer the following 10 questions to test your phishing awareness.</strong></p>
      <div id="quizContainer"></div>

      <div class="mt-3">
        <h6 id="quizScore" class="text-primary">Score: 0 / 10</h6>
        <button id="retakeQuiz" class="btn btn-outline-secondary btn-sm" style="display:none;">üîÅ Retake Quiz</button>
      </div>
    </div>
  </div>

    <div class="card">
      <div class="card-header">üìã Best Practices Summary</div>
      <div class="card-body">
        <div class="doc-section">
          <h3>What to Do When You Receive a Suspicious Email</h3>
          <ul class="doc-list">
            <li><strong>Step 1:</strong> Don't panic. Take a moment to carefully examine the email.</li>
            <li><strong>Step 2:</strong> Check the sender's email address for any discrepancies or misspellings.</li>
            <li><strong>Step 3:</strong> Hover over any links (don't click) to see where they actually lead.</li>
            <li><strong>Step 4:</strong> Look for red flags: urgency, threats, generic greetings, spelling errors.</li>
            <li><strong>Step 5:</strong> If suspicious, report it to your IT/Security team immediately.</li>
            <li><strong>Step 6:</strong> Delete the email after reporting. Do not forward it to others.</li>
          </ul>
        </div>

        <div class="doc-section">
          <h3>Remember These Key Points</h3>
          <ul class="doc-list">
            <li><strong>Trust your instincts:</strong> If something feels wrong, it probably is.</li>
            <li><strong>Verify independently:</strong> Contact the company directly using official contact information.</li>
            <li><strong>Use strong passwords:</strong> Different passwords for different accounts.</li>
            <li><strong>Enable 2FA:</strong> Two-factor authentication adds an extra layer of security.</li>
            <li><strong>Keep software updated:</strong> Regular updates patch security vulnerabilities.</li>
            <li><strong>Report everything:</strong> Even false alarms help the security team protect everyone.</li>
          </ul>
        </div>
      </div>
    </div>

  </div>

  <script>
const token = "{{ token }}";
const quizData = [
  {
    q: "What‚Äôs the best first step if you receive a suspicious email?",
    options: [
      "Click the link to verify what it does",
      "Forward it to your coworkers",
      "Report it to IT/Security immediately",
      "Reply asking if it‚Äôs real"
    ],
    correct: 2
  },
  {
    q: "Which is a common sign of phishing?",
    options: [
      "Correct grammar and professional tone",
      "Urgent request to update credentials",
      "Email from your manager about a meeting",
      "Using your name in greeting"
    ],
    correct: 1
  },
  {
    q: "What should you check before clicking a link?",
    options: [
      "The time email was sent",
      "The font color",
      "The actual destination URL (hover first)",
      "The background color"
    ],
    correct: 2
  },
  {
    q: "What type of file is most suspicious in attachments?",
    options: [
      ".pdf",
      ".jpg",
      ".exe",
      ".docx"
    ],
    correct: 2
  },
  {
    q: "Phishing emails often:",
    options: [
      "Contain spelling errors and fake logos",
      "Use encrypted communication",
      "Come from official IT systems",
      "Include no links or buttons"
    ],
    correct: 0
  },
  {
    q: "Two-factor authentication (2FA) helps because:",
    options: [
      "It allows faster logins",
      "It adds an extra layer of identity verification",
      "It replaces the need for passwords",
      "It hides your email address"
    ],
    correct: 1
  },
  {
    q: "If you‚Äôre unsure about an email‚Äôs legitimacy, you should:",
    options: [
      "Delete it immediately without checking",
      "Click links to confirm authenticity",
      "Contact the organization via official channels",
      "Ignore it forever"
    ],
    correct: 2
  },
  {
    q: "Which greeting is more suspicious?",
    options: [
      "Hi Alex, please see attached invoice.",
      "Dear Customer, urgent action required!",
      "Meeting at 2pm today",
      "Welcome to the new project team!"
    ],
    correct: 1
  },
  {
    q: "What should you do after identifying a phishing email?",
    options: [
      "Report it and delete the email",
      "Share it with colleagues for fun",
      "Forward it to random addresses",
      "Click unsubscribe"
    ],
    correct: 0
  },
  {
    q: "Phishing primarily targets:",
    options: [
      "Only executives",
      "All users, regardless of rank",
      "Only IT staff",
      "Only HR departments"
    ],
    correct: 1
  }
];

let currentQuestion = 0;
let score = 0;
let quizCompleted = false;
const quizContainer = document.getElementById('quizContainer');
const quizScore = document.getElementById('quizScore');
const retakeBtn = document.getElementById('retakeQuiz');

function renderQuestion() {
  if (currentQuestion >= quizData.length) {
    quizCompleted = true;
    quizContainer.innerHTML = `<p class="mt-3"><strong>üéâ You finished the quiz!</strong></p>`;
    quizScore.innerHTML = `<strong class="text-success">Final Score: ${score} / ${quizData.length}</strong>`;
    retakeBtn.style.display = 'inline-block';
    sendTrainingProgress();
    return;
  }

  const q = quizData[currentQuestion];
  quizContainer.innerHTML = `
    <div class="mb-3">
      <p><strong>Q${currentQuestion + 1}. ${q.q}</strong></p>
      ${q.options.map((opt, i) => `
        <div class="form-check">
          <input class="form-check-input" type="radio" name="q${currentQuestion}" id="q${currentQuestion}_${i}" value="${i}">
          <label class="form-check-label" for="q${currentQuestion}_${i}">${opt}</label>
        </div>`).join('')}
      <button class="btn btn-success btn-sm mt-2" onclick="checkAnswer()">Submit Answer</button>
    </div>
  `;
}

function checkAnswer() {
  const selected = document.querySelector(`input[name="q${currentQuestion}"]:checked`);
  if (!selected) return alert("Please select an answer before submitting.");

  const answer = parseInt(selected.value);
  if (answer === quizData[currentQuestion].correct) {
    score++;
    quizScore.innerHTML = `Score: ${score} / ${quizData.length}`;
  }

  currentQuestion++;
  renderQuestion();
}

function resetQuiz() {
  currentQuestion = 0;
  score = 0;
  quizCompleted = false;
  quizScore.innerHTML = "Score: 0 / 10";
  retakeBtn.style.display = 'none';
  renderQuestion();
}

retakeBtn.addEventListener('click', resetQuiz);

function sendTrainingProgress() {
  fetch('/training/complete', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ token: token, answers: score })
  }).catch(err => console.error("Progress not saved:", err));
}

renderQuestion();

const completeBtn = document.getElementById('completeBtn');
const status = document.getElementById('statusMessage');

completeBtn.addEventListener('click', async () => {
  completeBtn.disabled = true;
  status.textContent = "Saving your training record...";
  status.className = "";

  try {
    const resp = await fetch('/training/complete', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ token: token, answers: score })
    });
    const data = await resp.json();
    if (resp.ok) {
      status.innerHTML = '<span class="text-success">‚úÖ Training completed successfully! Redirecting...</span>';
      setTimeout(()=>{ window.location.href = "{{ url_for('frontpage') }}"; }, 2000);
    } else {
      status.innerHTML = '<span class="text-danger">‚ùå Error: ' + (data.error || 'Unknown error') + '</span>';
      completeBtn.disabled = false;
    }
  } catch (e) {
    status.innerHTML = '<span class="text-danger">‚ùå Network error ‚Äî please try again later.</span>';
    completeBtn.disabled = false;
  }
});
</script>
</body>
</html>